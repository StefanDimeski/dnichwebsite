<!DOCTYPE html>
<html>
    <head>
        <script
          src="https://code.jquery.com/jquery-3.6.0.js"
          integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
          crossorigin="anonymous"></script>

        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>


       <script type="text/javascript">
            function getText() {
                document.getElementById('name_field').innerHTML = localStorage.name;
            }

            function picture() {
                input = document.getElementById('inpFile');
                imgHolder = document.getElementById('imgPreviewsHolder');

                file = input.files[0];

                console.log(file)

                let reader = new FileReader();

                reader.readAsDataURL(file);

                reader.onload = function() {
                    var elem = document.createElement('img');

                    elem.src = reader.result;
                    elem.style.width = '200px';
                    elem.style.height = '100px';
                    elem.className = 'mx-1 mb-1'

                    imgHolder.appendChild(elem);
                };

                reader.onerror = function() {
                    console.log(reader.error);
                };
            }

            function startInitiative() {
                var initiatives = JSON.parse(localStorage.initiatives);

                var title = document.getElementById('initiative_title_field').value;
                var descr = document.getElementById('initiative_descr_field').value;

                var imgHolder = document.getElementById('imgPreviewsHolder');

                var children = imgHolder.children;

                var imgSrcs = [];

                for (i = 0; i < children.lenght; i++) {
                    imgSrcs.push(children[i].src);
                }

                initiatives.push({title: title, descr: descr, images: imgSrcs, anon: false});

                localStorage.initiatives = JSON.stringify(initiatives);

                var path = "initiative_preview.html?num=" + (initiatives.length - 1).toString();

                window.location.href = path; 
            }

            function startInitiativeAnon() {

                var initiatives = JSON.parse(localStorage.initiatives);

                var title = document.getElementById('initiative_title_field').value;
                var descr = document.getElementById('initiative_descr_field').value;

                var imgHolder = document.getElementById('imgPreviewsHolder');

                var children = imgHolder.children;

                var imgSrcs = [];

                for (i = 0; i < children.length; i++) {
                    imgSrcs.push(children[i].src);
                }

                initiatives.push({title: title, descr: descr, images: imgSrcs, anon: true});

                localStorage.initiatives = JSON.stringify(initiatives);

                var path = "initiative_preview.html?num=" + (initiatives.length - 1).toString();

                window.location.href = path; 
            }
        </script>
    </head>


    <body onload='getText()'>
      <nav class="navbar navbar-light" style='background-color: #333333;'>
            <div class="container-fluid">
                <div>
                    <a class="navbar-brand" style='color: #49C1CB; font-weight: bold; font-size: 2.0rem;' href="#">Initiativia</a>
                    <button type='button' class='btn btn-primary'>Back</button>
                </div>
                <div>
                    <a href='register.html'>
                        <button type="button" id='name_field' class="btn btn-primary" style='background-color: #49C1CB; color: black; border-color: #49C1CB;'>Placeholder</button>
                    </a>
                </div>
            </div>
        </nav>

        <div class='container-fluid ml-3'>
            <div class='row'>
                <div class='col-9'>
                    <div class='row'>
                        <div style='color: #49C1CB; font-weight: bold; font-size: 2.0rem;'>Start a new initiative</div>
                    </div>
                    <div class='row'>
                        <input type="email" class="form-control" id="initiative_title_field" placeholder="Title">
                        <div>Title must be between 10 and 25 characters </div>
                        <input type="email" class="form-control" id="initiative_descr_field" placeholder="Describe your initiative">
                    </div>
                    <div class='row'>
                        <div id='imgPreviewsHolder'>
                            <!--<img src='' id='previewPic'>-->
                        </div>
                        <label class="btn btn-primary">+ Add image<input type="file" id='inpFile' name="img" accept="image/*" onchange="picture()"hidden></label>

                        <div>File sizes of 32MB or less</div>
                    </div>
                    <div class='row'>
                        <button type='button' class='btn btn-danger' onclick='startInitiative()'>Start initiative</button>
                        <button type='button' class='btn btn-success' onclick='startInitiativeAnon()'>Start initiative anonymously</button>
                    </div>

                    <img id='testid'>
                </div>
                <div class='col-3' style='border: 0px solid black; border-left-width: 2px;'>
                    <h1>Tips:</h1>
                    <p>- keep titles short and clean (our data shows shorter titles generate more traction).</p>
                </div>
            </div>
        </div>
    </body>
</html>